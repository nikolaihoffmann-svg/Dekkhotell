<!DOCTYPE html>
<html lang="no" data-theme="auto">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dekkhotell</title>
<style>
:root{--bg:#0c1016;--card:#151b24;--text:#f3f3f3;--muted:#9ca3af;--brand:#3a6df0;--ok:#24d65f;--danger:#ef4444;--border:#1e2633;--accent:#2ec4b6;--shadow:0 2px 6px rgba(0,0,0,.35)}
@media(prefers-color-scheme:light){:root[data-theme="auto"]{--bg:#f6f8fb;--card:#fff;--text:#0b0f14;--muted:#475569;--brand:#2463eb;--ok:#16a34a;--danger:#e11d48;--border:#e7eef6;--accent:#0ea5a0;--shadow:0 2px 10px rgba(16,24,40,.08)}}
:root[data-theme="light"]{--bg:#f6f8fb;--card:#fff;--text:#0b0f14;--muted:#475569;--brand:#2463eb;--ok:#16a34a;--danger:#e11d48;--border:#e7eef6;--accent:#0ea5a0;--shadow:0 2px 10px rgba(16,24,40,.08)}
:root[data-theme="dark"]{--bg:#0c1016;--card:#151b24;--text:#f3f3f3;--muted:#9ca3af;--brand:#3a6df0;--ok:#24d65f;--danger:#ef4444;--border:#1e2633;--accent:#2ec4b6;--shadow:0 2px 6px rgba(0,0,0,.35)}

*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial,sans-serif;min-height:100vh;display:flex;flex-direction:column;transition:background .2s ease,color .2s ease}

/* Header */
header{background:var(--card);padding:10px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px;border-bottom:1px solid var(--border);box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
.brand{display:flex;align-items:center;gap:8px}
.logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--accent))}
.title{font-weight:800}
.tools{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
input[type="search"]{background:transparent;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:8px 12px;width:min(360px,46vw)}
.counter{color:var(--muted);font-size:.9rem}
select{background:transparent;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:8px 10px}
.btn{border:1px solid var(--border);background:transparent;color:var(--text);border-radius:999px;padding:8px 12px;cursor:pointer;transition:.15s}
.btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
.btn:hover{background:color-mix(in oklab,var(--brand) 14%,transparent)}
main{flex:1;padding:14px}

/* Kompaktliste */
.card.compact{background:var(--card);padding:10px 14px;border-radius:12px;margin-bottom:8px;cursor:pointer;border:1px solid var(--border);transition:background .2s ease,border-color .2s ease}
.card.compact.open{background:color-mix(in oklab,var(--brand) 6%,var(--card));border-color:color-mix(in oklab,var(--brand) 28%,var(--border))}
.card.compact .mainline{display:flex;justify-content:space-between;align-items:center;gap:8px}
.card.compact .left{display:flex;align-items:center;gap:8px;min-width:0}
.card.compact .reg{font-weight:800}
.card.compact .right{display:flex;align-items:center;gap:8px}
.badge{padding:3px 8px;border-radius:999px;font-size:.8rem;border:1px solid var(--border)}
.ok{background:color-mix(in oklab,var(--ok) 40%,transparent);color:#06260f;border-color:color-mix(in oklab,var(--ok) 60%,var(--border))}
.danger{background:color-mix(in oklab,var(--danger) 28%,transparent);color:#3b0b0b;border-color:color-mix(in oklab,var(--danger) 55%,var(--border))}
.card.compact .chev{display:inline-block;transition:transform .2s ease;opacity:.9}
.card.compact.open .chev{transform:rotate(180deg)}
.card.compact .details{border-top:1px solid var(--border);margin-top:6px;padding-top:6px;font-size:.95rem;overflow:hidden}
.meta{color:var(--muted);margin-top:3px}
.actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.actions button{border:1px solid var(--border);background:transparent;color:var(--text);border-radius:8px;padding:6px 10px;font-size:.85rem}
.actions .ok{background:var(--ok);border-color:var(--ok);color:#06260f}
.actions .danger{background:var(--danger);border-color:var(--danger);color:#fff}
.empty{color:var(--muted);text-align:center;margin-top:16px}

/* Dialog */
dialog{border:none;border-radius:12px;padding:18px 20px;background:var(--card);color:var(--text);max-width:520px;width:92%;box-shadow:var(--shadow);animation:pop .2s ease}
@keyframes pop{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
dialog::backdrop{background:rgba(0,0,0,.45)}
form{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
form .row-2{grid-column:1/-1}
label{font-size:.9rem;color:var(--muted)}
input,textarea{width:100%;padding:8px 10px;margin-top:4px;border:1px solid var(--border);border-radius:8px;background:transparent;color:var(--text)}
textarea{resize:vertical;min-height:70px}
form .actions{grid-column:1/-1;display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end;margin-top:4px}

/* Hurtigvalg-bokser */
.quickbox{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.quickbox button{background:color-mix(in oklab,var(--brand) 12%,transparent);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:6px 10px;font-size:.85rem;cursor:pointer;transition:.15s}
.quickbox button:hover{background:var(--brand);color:#fff}

/* Flytende + Ny knapp */
.fab{position:fixed;right:14px;bottom:14px;z-index:20;background:var(--brand);color:#fff;border:none;border-radius:999px;padding:14px 16px;font-weight:700;box-shadow:var(--shadow)}
@media(max-width:640px){input[type="search"]{width:44vw}}
</style>
</head>

<body>
<header>
  <div class="brand"><div class="logo"></div><div class="title">Dekkhotell</div></div>
  <div class="tools">
    <button id="themeBtn" class="btn" title="Bytt tema">üåû/üåô</button>
    <input id="search" type="search" placeholder="S√∏k regnr, navn‚Ä¶" />
    <span id="count" class="counter"></span>

    <!-- üîΩ Preset-velger for etiketter -->
    <select id="labelPreset" title="Etikett-format">
      <option value="A4-50x30" selected>A4 ‚Äì 50√ó30 mm (3 kol)</option>
      <option value="DYMO-99012">DYMO 99012 ‚Äì 89√ó28 mm</option>
      <option value="DYMO-11354">DYMO 11354 ‚Äì 57√ó32 mm</option>
      <option value="DYMO-99014">DYMO 99014 ‚Äì 101√ó54 mm</option>
      <option value="BRO-DK11209">Brother DK-11209 ‚Äì 62√ó29 mm</option>
      <option value="BRO-DK11201">Brother DK-11201 ‚Äì 90√ó29 mm</option>
      <option value="BRO-DK11208">Brother DK-11208 ‚Äì 90√ó38 mm</option>
      <option value="BRO-DK22205">Brother DK-22205 ‚Äì 62 mm rull (kontinuerlig)</option>
    </select>

    <button id="printBtn" class="btn">üè∑Ô∏è Etiketter</button>
    <button id="exportBtn" class="btn">üì§ Eksporter</button>
    <button id="importBtn" class="btn">üì• Importer</button>
    <input id="importFile" type="file" accept="application/json" hidden>
    <button id="newBtn" class="btn primary">+ Ny</button>
  </div>
</header>

<main id="list"></main>
<div id="empty" class="empty" hidden>Ingen treff ‚Ä¶</div>
<button id="fab" class="fab">+ Ny</button>

<!-- Ny/Rediger -->
<dialog id="editDlg">
  <h2 id="dlgTitle">Ny registrering</h2>
  <form id="editForm" autocomplete="on">
    <div><label>Regnr<input name="reg" required placeholder="FT31184"></label></div>
    <div><label>Kunde<input name="customer" placeholder="Ola Nordmann"></label></div>
    <div><label>Telefon<input name="phone" inputmode="tel" placeholder="90000000"></label></div>
    <div><label>Plassering<input name="location" placeholder="Reol A1"></label></div>
    <div><label>Merke<input name="brand" placeholder="Michelin"></label></div>
    <div><label>St√∏rrelse<input name="size" placeholder="205/55 R16"></label></div>

    <!-- Felg + hurtigvalg -->
    <div>
      <label>Felg
        <input name="rims" placeholder="Alu / St√•l" id="rimsInput">
      </label>
      <div class="quickbox" id="rimsQuick">
        <button type="button">Alu</button>
        <button type="button">St√•l</button>
        <button type="button">Originale</button>
        <button type="button">Uoriginale</button>
      </div>
    </div>

    <!-- Sesong + hurtigvalg -->
    <div>
      <label>Sesong
        <input name="season" placeholder="Sommer / Vinter" id="seasonInput">
      </label>
      <div class="quickbox" id="seasonQuick">
        <button type="button">Sommerdekk</button>
        <button type="button">Piggfri vinterdekk</button>
        <button type="button">Piggdekk</button>
      </div>
    </div>

    <div class="row-2"><label>Notater<textarea name="notes" placeholder="M√∏nsterdybde, skader ‚Ä¶"></textarea></label></div>
    <div class="actions">
      <button type="button" id="cancelEdit" class="btn">Avbryt</button>
      <button type="submit" class="btn primary" style="background:var(--brand);color:#fff;border-color:var(--brand)">Lagre</button>
    </div>
  </form>
</dialog>

<script>
/* Tema-bryter */
(function(){
  const key='dekk.theme';
  const btn=document.getElementById('themeBtn');
  function setTheme(v){ document.documentElement.setAttribute('data-theme',v); localStorage.setItem(key,v);
    btn.textContent = v==='dark'?'üåô' : (v==='light'?'üåû' : 'üåû/üåô'); }
  setTheme(localStorage.getItem(key)||'auto');
  btn.addEventListener('click',()=>{
    const cur=document.documentElement.getAttribute('data-theme')||'auto';
    const next = cur==='auto' ? 'dark' : (cur==='dark' ? 'light' : 'auto');
    setTheme(next);
  });
})();

/* Data & lagring */
let rows = JSON.parse(localStorage.getItem('dekk.rows')||'[]');
if(!rows.length){
  rows = [
    {id:crypto.randomUUID?.()||'1',reg:'FT31184',customer:'Ola Nordmann',phone:'90012345',location:'Reol A1',
     brand:'Michelin',size:'205/55 R16',rims:'Alu',season:'Sommerdekk',notes:'God stand',
     status:'inn',checkIn:'2025-03-10',checkOut:'',updatedAt:new Date().toISOString()}
  ];
  localStorage.setItem('dekk.rows', JSON.stringify(rows));
}
const save=()=>localStorage.setItem('dekk.rows', JSON.stringify(rows));

/* UI-elementer */
const listEl=document.getElementById('list');
const emptyEl=document.getElementById('empty');
const countEl=document.getElementById('count');
const searchEl=document.getElementById('search');
const labelPresetEl=document.getElementById('labelPreset');
const newBtn=document.getElementById('newBtn');
const fab=document.getElementById('fab');
const exportBtn=document.getElementById('exportBtn');
const importBtn=document.getElementById('importBtn');
const importFile=document.getElementById('importFile');
const printBtn
